<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCP ToolBox æ§åˆ¶ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="woff.css">
    <link rel="icon" href="favicon.ico">
    <!-- EasyMDE for Markdown Editing -->
    <link rel="stylesheet" href="easymde.min.css">
    <script src="easymde.min.js"></script>
    <!-- Markdown Renderer -->
    <script src="marked.min.js"></script>
   <style>
        /* EasyMDE ä¸»é¢˜é€‚é… */
        .editor-toolbar {
            background-color: var(--background-color-light) !important;
            border-color: var(--border-color) !important;
        }
        .editor-toolbar button {
            color: var(--text-color-primary) !important;
        }
        .editor-toolbar button:hover,
        .editor-toolbar button.active {
            background-color: var(--primary-color-translucent) !important;
            border-color: var(--border-color) !important;
        }
        
        .CodeMirror {
            background-color: var(--background-color) !important;
            color: var(--text-color-primary) !important;
            border-color: var(--border-color) !important;
            height: auto !important;
            min-height: 500px !important;
        }
        .CodeMirror-scroll {
            min-height: 500px !important;
        }
        .CodeMirror-cursor {
            border-left-color: var(--text-color-primary) !important;
        }
        body .CodeMirror-selected {
            background-color: var(--primary-color-translucent) !important;
        }
        .CodeMirror-gutters {
            background-color: var(--background-color-light) !important;
            border-right: 1px solid var(--border-color) !important;
        }

        .log-content-area .highlight {
            background-color: var(--primary-color);
            color: var(--background-color);
            border-radius: 3px;
            padding: 0 2px;
        }
        
        /* ä¿®å¤å…¨å±é¢„è§ˆé‡å é—®é¢˜ */
        .editor-preview-active .CodeMirror {
            display: none !important;
        }
        
        /* å¹¶æ’é¢„è§ˆæ¨¡å¼æ ·å¼ */
        .editor-preview-side {
            background-color: var(--background-color) !important;
            color: var(--text-color-primary) !important;
            border-left: 1px solid var(--border-color) !important;
            padding: 10px 20px !important;
        }
        
        /* å…¨å±é¢„è§ˆæ¨¡å¼æ ·å¼ - åªè®¾ç½®é¢œè‰²ï¼Œè®©EasyMDEå¤„ç†å¸ƒå±€ */
        .editor-preview {
            background-color: var(--background-color) !important;
            color: var(--text-color-primary) !important;
            padding: 20px !important;
        }
        
        /* é¢„è§ˆæ¨¡å¼ä¸‹çš„Markdownæ ·å¼ */
        .editor-preview h1, .editor-preview-side h1,
        .editor-preview h2, .editor-preview-side h2,
        .editor-preview h3, .editor-preview-side h3 {
            color: var(--text-color-primary) !important;
        }
        
        .editor-preview a, .editor-preview-side a {
            color: var(--primary-color) !important;
        }
        
        .editor-preview code, .editor-preview-side code {
            background-color: var(--background-color-light) !important;
            color: var(--text-color-primary) !important;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .editor-preview pre, .editor-preview-side pre {
            background-color: var(--background-color-light) !important;
            color: var(--text-color-primary) !important;
            padding: 10px;
            border-radius: 5px;
        }
        
        /* é¢„è§ˆæ¨¡å¼ä¸‹çš„ Markdown æ¸²æŸ“æ ·å¼ */
        .editor-preview h1, .editor-preview-side h1,
        .editor-preview h2, .editor-preview-side h2,
        .editor-preview h3, .editor-preview-side h3,
        .editor-preview h4, .editor-preview-side h4,
        .editor-preview h5, .editor-preview-side h5,
        .editor-preview h6, .editor-preview-side h6 {
            color: var(--text-color-primary) !important;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }
        
        .editor-preview a, .editor-preview-side a {
            color: var(--primary-color) !important;
        }
        
        .editor-preview code, .editor-preview-side code {
            background-color: var(--background-color-light) !important;
            color: var(--text-color-primary) !important;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .editor-preview pre, .editor-preview-side pre {
            background-color: var(--background-color-light) !important;
            color: var(--text-color-primary) !important;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .editor-preview pre code, .editor-preview-side pre code {
            background-color: transparent !important;
        }
        
        .editor-preview blockquote, .editor-preview-side blockquote {
            border-left: 4px solid var(--border-color) !important;
            padding-left: 10px;
            margin-left: 0;
            color: var(--text-color-secondary) !important;
        }
        
        .editor-preview table, .editor-preview-side table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }
        
        .editor-preview th, .editor-preview-side th,
        .editor-preview td, .editor-preview-side td {
            border: 1px solid var(--border-color) !important;
            padding: 8px;
            color: var(--text-color-primary) !important;
        }
        
        .editor-preview th, .editor-preview-side th {
            background-color: var(--background-color-light) !important;
            font-weight: bold;
        }
        
        .editor-preview hr, .editor-preview-side hr {
            border: none;
            border-top: 1px solid var(--border-color) !important;
            margin: 1em 0;
        }
        
        .editor-preview ul, .editor-preview-side ul,
        .editor-preview ol, .editor-preview-side ol {
            color: var(--text-color-primary) !important;
            padding-left: 2em;
        }
        
        .editor-preview p, .editor-preview-side p {
            color: var(--text-color-primary) !important;
            line-height: 1.6;
        }
        
       .draggable-list {
           list-style: none;
           padding: 0;
           margin-top: 1rem;
       }
       .draggable-list li {
           background-color: var(--background-color-light);
           padding: 15px 20px;
           margin-bottom: 10px;
           border-radius: 8px;
           cursor: grab;
           display: flex;
           align-items: center;
           border: 1px solid var(--border-color);
           transition: background-color 0.2s, box-shadow 0.2s;
           user-select: none;
       }
       .draggable-list li.dragging {
           opacity: 0.6;
           background-color: var(--primary-color-translucent);
           box-shadow: 0 4px 12px rgba(0,0,0,0.1);
       }
       .draggable-list li .plugin-info {
           display: flex;
           flex-direction: column;
       }
       .draggable-list li .plugin-name {
           font-weight: bold;
           color: var(--text-color-primary);
       }
       .draggable-list li .plugin-description {
           font-size: 0.9em;
           color: var(--text-color-secondary);
           margin-top: 4px;
       }
       .preprocessor-order-controls {
           display: flex;
           gap: 15px;
           align-items: center;
           margin-bottom: 1rem;
       }
       #plugin-nav a {
           display: block;
           white-space: pre-wrap;
           line-height: 1.3;
           padding: 10px 12px;
           min-height: 40px; /* ç¡®ä¿è¶³å¤Ÿé«˜åº¦å®¹çº³ä¸¤è¡Œ */
           align-items: center;
       }
       #plugin-nav .plugin-original-name {
           display: block;
           font-size: 0.75em;
           color: var(--text-color-secondary);
           font-weight: normal;
           font-style: italic;
           margin-top: 1px;
           padding-left: 20px; /* ä¸å›¾æ ‡å¯¹é½ */
       }
       #plugin-nav li {
           padding: 0; /* è°ƒæ•´li paddingä»¥é€‚åº”açš„padding */
       }
       /* VCP Forum Styles */
       .forum-controls {
           margin-bottom: 1rem;
           display: flex;
           align-items: center;
           gap: 1rem;
       }
       .forum-posts-container {
           display: flex;
           flex-direction: column;
           gap: 1rem;
       }
       .forum-post-item {
           background-color: var(--background-color-light);
           border: 1px solid var(--border-color);
           border-radius: 8px;
           padding: 1rem;
           cursor: pointer;
           transition: background-color 0.2s;
       }
       .forum-post-item:hover {
           background-color: var(--primary-color-translucent);
       }
       .forum-post-header {
           font-weight: bold;
           font-size: 1.1em;
           margin-bottom: 0.5rem;
       }
       .forum-post-meta {
           font-size: 0.9em;
           color: var(--text-color-secondary);
       }
       .forum-post-content-view {
           margin-top: 1rem;
           padding: 1rem;
           background-color: var(--background-color);
           border-radius: 8px;
       }
       .forum-reply-area {
           margin-top: 1rem;
           border-top: 1px solid var(--border-color);
           padding-top: 1rem;
       }
       .forum-reply-area textarea {
           width: 100%;
           min-height: 100px;
           margin-bottom: 0.5rem;
       }
       .forum-posts-list tr.pinned-post {
           background-color: var(--primary-color-translucent);
           font-weight: bold;
       }
       .forum-posts-list tr.pinned-post:hover {
           background-color: var(--primary-color);
           color: var(--background-color);
       }
       .forum-posts-list tr.pinned-post .post-meta {
            color: var(--text-color-primary);
       }
       
   </style>
 </head>
 <body>
   <div class="solar-system-bg" aria-hidden="true">
       <div class="stars"></div>
       <div class="stars2"></div>
       <div class="stars3"></div>
       <div class="sun"></div>
       <div class="orbit orbit-mercury"><div class="planet planet-mercury"></div></div>
       <div class="orbit orbit-venus"><div class="planet planet-venus"></div></div>
       <div class="orbit orbit-earth"><div class="planet planet-earth"></div></div>
       <div class="orbit orbit-mars"><div class="planet planet-mars"></div></div>
       <div class="orbit orbit-jupiter"><div class="planet planet-jupiter"></div></div>
       <div class="orbit orbit-saturn"><div class="planet planet-saturn"></div></div>
       <div class="orbit orbit-uranus"><div class="planet planet-uranus"></div></div>
       <div class="orbit orbit-neptune"><div class="planet planet-neptune"></div></div>
       <div class="shooting-stars">
           <div class="shooting-star"></div>
           <div class="shooting-star"></div>
           <div class="shooting-star"></div>
       </div>
       <button id="exit-immersive-button" class="exit-immersive-button">é€€å‡ºæ²‰æµ¸æ¨¡å¼</button>
   </div>
    <header class="top-bar">
        <div class="top-bar-content">
            <button id="mobile-menu-toggle" class="mobile-menu-toggle">
                <span class="material-symbols-outlined">menu</span>
            </button>
            <div class="brand">
                <span class="material-symbols-outlined brand-icon">terminal</span>
                <span class="server-title">VCPToolBox</span>
            </div>
            <div class="header-actions">
                <button id="restart-server-button" class="restart-button">
                    <span class="material-symbols-outlined">restart_alt</span>
                    é‡å¯æœåŠ¡å™¨
                </button>
                <button id="theme-toggle-button" class="theme-button">
                    <span class="material-symbols-outlined">contrast</span>
                    åˆ‡æ¢ä¸»é¢˜
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>æ§åˆ¶ä¸­å¿ƒ</h1>
                <input type="search" id="sidebar-search" placeholder="æœç´¢åŠŸèƒ½é¡µé¢...">
            </div>
            <nav id="plugin-nav">
                <ul>
                    <li><a href="#" data-target="dashboard" class="active"><span class="material-symbols-outlined">dashboard</span>ä»ªè¡¨ç›˜</a></li>
                    <li class="nav-category">â€”â€”â€”â€” æ ¸ å¿ƒ åŠŸ èƒ½ â€”â€”â€”â€”</li>
                    <li><a href="#" data-target="base-config"><span class="material-symbols-outlined">settings</span>å…¨å±€åŸºç¡€é…ç½®</a></li>
                    <li><a href="#" data-target="daily-notes-manager"><span class="material-symbols-outlined">description</span>æ—¥è®°çŸ¥è¯†åº“ç®¡ç†</a></li>
                    <li><a href="#" data-target="vcp-forum"><span class="material-symbols-outlined">forum</span>VCPè®ºå›</a></li>
                    <li><a href="#" data-target="image-cache-editor"><span class="material-symbols-outlined">photo_library</span>å¤šåª’ä½“Base64ç¼–è¾‘å™¨</a></li>
                    <li><a href="#" data-target="semantic-groups-editor"><span class="material-symbols-outlined">hub</span>è¯­ä¹‰ç»„ç¼–è¾‘å™¨</a></li>
                    <li><a href="#" data-target="vcptavern-editor"><span class="material-symbols-outlined">casino</span>VCPTaverné¢„è®¾ç¼–è¾‘</a></li>
                    <li><a href="#" data-target="agent-files-editor"><span class="material-symbols-outlined">smart_toy</span>Agentç®¡ç†å™¨</a></li>
                    <li><a href="#" data-target="agent-assistant-config"><span class="material-symbols-outlined">diversity_3</span>AgentåŠ©æ‰‹é…ç½®</a></li>
                    <li><a href="#" data-target="tvs-files-editor"><span class="material-symbols-outlined">data_object</span>é«˜çº§å˜é‡ç¼–è¾‘å™¨</a></li>
                    <li><a href="#" data-target="tool-list-editor"><span class="material-symbols-outlined">construction</span>å·¥å…·åˆ—è¡¨é…ç½®ç¼–è¾‘å™¨</a></li>
                    <li><a href="#" data-target="preprocessor-order-manager"><span class="material-symbols-outlined">sort</span>é¢„å¤„ç†å™¨é¡ºåºç®¡ç†</a></li>
                    <li><a href="#" data-target="thinking-chains-editor"><span class="material-symbols-outlined">psychology</span>æ€ç»´é“¾ç¼–è¾‘å™¨</a></li>
                    <li><a href="#" data-target="schedule-manager"><span class="material-symbols-outlined">calendar_month</span>æ—¥ç¨‹ç®¡ç†</a></li>
                    <li><a href="#" data-target="rag-tuning"><span class="material-symbols-outlined">tune</span>æµªæ½®RAGè°ƒå‚</a></li>
                    <li><a href="#" data-target="server-log-viewer"><span class="material-symbols-outlined">terminal</span>æœåŠ¡å™¨æ—¥å¿—</a></li>
                    <li class="nav-category" id="plugins-category">â€”â€”â€”â€” æ’ ä»¶ ç®¡ ç† â€”â€”â€”â€”</li>
                    <!-- æ’ä»¶åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
                </ul>
            </nav>
        </aside>

        <main class="content" id="config-details-container">
            <!-- Section: Dashboard -->
            <section id="dashboard-section" class="config-section active-section">
                <h2>ä»ªè¡¨ç›˜</h2>
                <div class="vcp-animation-container">
                    <div class="vcp-logo-container">
                        <img src="VCPLogo2.png" alt="VCP Logo" class="vcp-logo" id="vcp-logo-main">
                    </div>
                    <canvas id="vcp-animation-canvas"></canvas>
                </div>
                <div class="dashboard-grid">
                    <div class="status-card cpu-card">
                        <h3>CPU ä½¿ç”¨ç‡</h3>
                        <div class="status-card-content">
                            <div class="progress-circle" id="cpu-progress" data-progress="0">
                                <svg width="120" height="120" viewBox="0 0 120 120">
                                    <circle class="progress-bg" cx="60" cy="60" r="54"></circle>
                                    <circle class="progress-bar" cx="60" cy="60" r="54"></circle>
                                </svg>
                                <span class="progress-text" id="cpu-usage-text">0%</span>
                            </div>
                            <p id="cpu-info-text">åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                    <div class="status-card memory-card">
                        <h3>å†…å­˜ä½¿ç”¨æƒ…å†µ</h3>
                        <div class="status-card-content">
                             <div class="progress-circle" id="mem-progress" data-progress="0">
                                <svg width="120" height="120" viewBox="0 0 120 120">
                                    <circle class="progress-bg" cx="60" cy="60" r="54"></circle>
                                    <circle class="progress-bar" cx="60" cy="60" r="54"></circle>
                                    <circle class="progress-bar-secondary" cx="60" cy="60" r="54"></circle>
                                </svg>
                                <span class="progress-text" id="mem-usage-text">0%</span>
                            </div>
                            <p id="mem-info-text">åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                    <div class="status-card process-card">
                        <h3>PM2 è¿›ç¨‹çŠ¶æ€</h3>
                        <div class="status-card-content" id="pm2-process-list">
                            <p>åŠ è½½ä¸­...</p>
                        </div>
                        <div class="auth-code-display">
                            <h4>ç”¨æˆ·è®¤è¯ç </h4>
                            <p id="user-auth-code-display">åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                    <div class="status-card node-card">
                        <h3>Node.js è¿›ç¨‹ä¿¡æ¯</h3>
                        <div class="status-card-content" id="node-info-list">
                           <p>åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                    <div class="status-card weather-card">
                        <h3>å¤©æ°”é¢„æŠ¥</h3>
                        <div class="weather-container">
                            <div class="weather-current">
                                <div class="current-main">
                                    <span id="weather-icon" class="material-symbols-outlined weather-icon-large">--</span>
                                    <div class="current-temp-box">
                                        <div class="temp-row">
                                            <span id="weather-temp">--</span><span class="unit">Â°C</span>
                                        </div>
                                        <div id="weather-text">åŠ è½½ä¸­...</div>
                                    </div>
                                </div>
                                <div class="current-details">
                                    <div class="detail-item">
                                        <span class="material-symbols-outlined">humidity_percentage</span>
                                        <span id="weather-humidity">--%</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="material-symbols-outlined">air</span>
                                        <span id="weather-wind">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="material-symbols-outlined">compress</span>
                                        <span id="weather-pressure">-- hPa</span>
                                    </div>
                                </div>
                            </div>
                            <div class="weather-forecast" id="weather-forecast">
                                <!-- é¢„æŠ¥å†…å®¹å°†åŠ¨æ€åŠ è½½ -->
                            </div>
                        </div>
                    </div>
                    <div class="status-card calendar-card">
                        <h3>æ—¥ç¨‹æ¦‚è§ˆ</h3>
                        <div id="dashboard-calendar-widget" class="calendar-widget">
                            <!-- æ—¥å†æŒ‚ä»¶å°†åŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                        </div>
                    </div>
                </div>
                <div class="activity-chart-container">
                    <h3>æœåŠ¡å™¨æ´»è·ƒåº¦</h3>
                    <canvas id="activity-chart-canvas"></canvas>
                </div>
            </section>
            
            <section id="base-config-section" class="config-section">
                <h2>å…¨å±€åŸºç¡€é…ç½® (config.env)</h2>
                <form id="base-config-form">
                    <button type="submit">ä¿å­˜å…¨å±€é…ç½®</button>
                </form>
            </section>

            <section id="daily-notes-manager-section" class="config-section">
                <h2>æ—¥è®°çŸ¥è¯†åº“ä¸RAGæ ‡ç­¾ç®¡ç†</h2>
                <div class="daily-notes-manager">
                    <div class="notes-sidebar">
                        <h3>çŸ¥è¯†åº“åˆ—è¡¨</h3>
                        <ul id="notes-folder-list"></ul>
                    </div>
                    <div class="notes-main-area">
                        <!-- RAG-Tagsé…ç½®åŒºåŸŸï¼ˆåœ¨æ—¥è®°åˆ—è¡¨ä¸Šæ–¹ï¼‰ -->
                        <div id="rag-tags-config-area" class="rag-tags-config-area" style="display: none;">
                            <div class="rag-tags-header">
                                <h3>çŸ¥è¯†åº“æ ‡ç­¾åˆ—è¡¨</h3>
                            </div>
                            <div class="kb-entry">
                                <div class="kb-header">
                                    <h3 id="rag-tags-folder-name"></h3>
                                </div>
                                <div class="threshold-controls">
                                    <input type="checkbox" id="rag-threshold-enabled">
                                    <label for="rag-threshold-enabled">å¯ç”¨é˜ˆå€¼:</label>
                                    <input type="range" id="rag-threshold-value" min="0.1" max="1.0" step="0.01" value="0.7" disabled>
                                    <span id="rag-threshold-display" class="threshold-value">0.70</span>
                                </div>
                                <div class="tags-container" id="rag-tags-container">
                                    <!-- æ ‡ç­¾å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                                </div>
                                <div class="add-tag-controls">
                                    <button id="add-rag-tag-button" class="add-tag-btn">æ·»åŠ æ ‡ç­¾</button>
                                </div>
                            </div>
                            <div class="rag-tags-controls">
                                <button id="save-rag-tags-config">ä¿å­˜æ›´æ”¹åˆ° rag_tags.json</button>
                                <span id="rag-tags-status" class="status-message"></span>
                            </div>
                        </div>

                        <!-- æ—¥è®°åˆ—è¡¨åŒºåŸŸ -->
                        <div class="notes-content-area">
                            <div class="notes-toolbar">
                                <input type="search" id="search-daily-notes" placeholder="æœç´¢æ—¥è®°..." aria-label="æœç´¢æ—¥è®°">
                                <button id="move-selected-notes" disabled>ç§»åŠ¨é€‰ä¸­é¡¹åˆ°...</button>
                                <select id="move-target-folder" disabled></select>
                                <button id="delete-selected-notes-button" disabled>æ‰¹é‡åˆ é™¤é€‰ä¸­é¡¹</button>
                                <span id="notes-action-status" class="status-message"></span>
                            </div>
                            <div id="notes-list-view"></div>
                        </div>

                        <!-- æ—¥è®°ç¼–è¾‘åŒºåŸŸ -->
                        <div id="note-editor-area" class="note-editor-area" style="display: none;">
                            <h3>ç¼–è¾‘æ—¥è®°</h3>
                            <input type="hidden" id="editing-note-folder">
                            <input type="hidden" id="editing-note-file">
                            <div class="config-editor-toolbar">
                                 <button id="save-note-content">ä¿å­˜æ—¥è®°</button>
                                 <button id="cancel-edit-note">å–æ¶ˆç¼–è¾‘</button>
                                 <span id="note-editor-status" class="status-message"></span>
                            </div>
                            <textarea id="note-content-editor" spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <section id="image-cache-editor-section" class="config-section">
                <h2>å›¾åƒç¼“å­˜ç¼–è¾‘å™¨</h2>
                <iframe data-src="image_cache_editor.html" style="width: 100%; height: 80vh; border: none;"></iframe>
            </section>

            <section id="semantic-groups-editor-section" class="config-section">
                <h2>è¯­ä¹‰ç»„ç¼–è¾‘å™¨</h2>
                <p class="description">ç®¡ç† RAGDiaryPlugin ä½¿ç”¨çš„è¯­ä¹‰ç»„ã€‚è¯­ä¹‰ç»„é€šè¿‡å…³é”®è¯æ¿€æ´»ï¼Œå°†ç›¸å…³çš„å‘é‡æ³¨å…¥æŸ¥è¯¢ï¼Œä»¥æé«˜æ£€ç´¢çš„å‡†ç¡®æ€§ã€‚</p>
                <div class="semantic-groups-controls">
                    <button id="save-semantic-groups-button">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
                    <button id="add-semantic-group-button">æ·»åŠ æ–°ç»„</button>
                    <span id="semantic-groups-status" class="status-message"></span>
                </div>
                <div id="semantic-groups-container">
                    <!-- Semantic groups will be dynamically loaded here -->
                </div>
            </section>

            <section id="vcptavern-editor-section" class="config-section">
                <h2>VCPTaverné¢„è®¾ç¼–è¾‘</h2>
                <iframe data-src="vcptavern_editor.html" style="width: 100%; height: 80vh; border: none;"></iframe>
            </section>

            <section id="agent-files-editor-section" class="config-section">
                <h2>Agent ç®¡ç†</h2>
                <p class="description">ç®¡ç† Agent çš„å®šä¹‰åç§°ä¸å¯¹åº”çš„ .txt æ–‡ä»¶ã€‚åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ Agent æ˜ å°„ï¼Œå¹¶ç›´æ¥ç¼–è¾‘å…³è”çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p>
                <div class="agent-manager-container">
                    <div class="agent-map-editor">
                        <h3>Agent æ˜ å°„è¡¨</h3>
                        <div class="agent-map-controls">
                            <button id="add-agent-map-entry-button">æ·»åŠ æ–° Agent</button>
                            <button id="create-agent-file-button">æ–°å»º Agent.txt æ–‡ä»¶</button>
                            <button id="save-agent-map-button">ä¿å­˜æ˜ å°„è¡¨</button>
                            <span id="agent-map-status" class="status-message"></span>
                        </div>
                        <div id="agent-map-list">
                            <!-- Agent map entries will be dynamically loaded here -->
                        </div>
                    </div>
                    <div class="agent-file-editor">
                        <h3>Agent æ–‡ä»¶å†…å®¹ (.txt)</h3>
                        <div class="agent-editor-controls">
                             <span id="editing-agent-file-display">æœªé€‰æ‹©æ–‡ä»¶</span>
                             <button id="save-agent-file-button" disabled>ä¿å­˜æ–‡ä»¶å†…å®¹</button>
                             <span id="agent-file-status" class="status-message"></span>
                        </div>
                        <textarea id="agent-file-content-editor" spellcheck="false" placeholder="ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ª Agent ä»¥ç¼–è¾‘å…¶å…³è”çš„ .txt æ–‡ä»¶..."></textarea>
                    </div>
                </div>
            </section>

            <section id="agent-assistant-config-section" class="config-section">
                <h2>Agent åŠ©æ‰‹é…ç½®ï¼ˆAgentAssistantï¼‰</h2>
                <p class="description">
                    è¿™é‡Œç”¨äºé…ç½® <strong>AgentAssistant</strong> æ’ä»¶ã€‚ä½ å¯ä»¥ï¼š
                    <br>1ï¼‰ä»å·²æ³¨å†Œçš„ Agent ä¸€é”®åˆ›å»ºåŠ©æ‰‹ï¼›
                    <br>2ï¼‰æ·»åŠ å®Œå…¨è‡ªå®šä¹‰çš„åŠ©æ‰‹ï¼›
                    <br>3ï¼‰ä¸ºæ¯ä¸ªåŠ©æ‰‹è®¾ç½®æ¨¡å‹ã€æ€§æ ¼è¯´æ˜å’Œç³»ç»Ÿæç¤ºè¯ã€‚
                    <br>æ‰€æœ‰ä¿®æ”¹ä¼šè‡ªåŠ¨å†™å…¥ <code>Plugin/AgentAssistant/config.env</code> ä¸­ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–è¾‘æ–‡æœ¬ã€‚
                </p>
                <div class="aa-config-container">
                    <div class="aa-global-settings">
                        <h3>å…¨å±€ä¼šè¯è®¾ç½®</h3>
                        <div class="aa-global-grid">
                            <div class="aa-global-item">
                                <label for="aa-max-history">
                                    æ¯ä¸ª Agent è®°ä½çš„å†å²è½®æ•°
                                </label>
                                <input type="number" id="aa-max-history" min="1" max="50" step="1" placeholder="ä¾‹å¦‚ï¼š7">
                                <p class="aa-hint">
                                    æ•°å€¼è¶Šå¤§ï¼ŒAgent èƒ½è®°ä½çš„ä¸Šä¸‹æ–‡è¶Šå¤šï¼Œä½†æ¯æ¬¡è°ƒç”¨æ¶ˆè€—çš„ Token ä¹Ÿä¼šå¢åŠ ã€‚
                                </p>
                            </div>
                            <div class="aa-global-item">
                                <label for="aa-context-ttl">
                                    ä¸Šä¸‹æ–‡ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰
                                </label>
                                <input type="number" id="aa-context-ttl" min="1" max="168" step="1" placeholder="ä¾‹å¦‚ï¼š24">
                                <p class="aa-hint">
                                    è¶…è¿‡è¿™ä¸ªæ—¶é—´æ²¡æœ‰å¯¹è¯æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†æ—§ä¼šè¯ï¼Œé˜²æ­¢è®°å¿†æ— é™å¢é•¿ã€‚
                                </p>
                            </div>
                        </div>
                        <div class="aa-global-item-full">
                            <label for="aa-global-system-prompt">
                                æ‰€æœ‰åŠ©æ‰‹å…±äº«çš„è¡¥å……ç³»ç»Ÿæç¤ºè¯ï¼ˆå¯é€‰ï¼‰
                            </label>
                            <textarea id="aa-global-system-prompt" rows="3" placeholder="ä¾‹å¦‚ï¼šç»Ÿä¸€è¦æ±‚æ‰€æœ‰åŠ©æ‰‹è¯´è¯æ›´æ¸©æŸ”ã€é¿å…è¾“å‡ºæ•æ„Ÿå†…å®¹ã€ç»Ÿä¸€ä½¿ç”¨æŸç§è¯­è¨€ç­‰ã€‚"></textarea>
                            <p class="aa-hint">
                                è¿™é‡Œçš„å†…å®¹ä¼šè‡ªåŠ¨è¿½åŠ åˆ°æ¯ä¸ªåŠ©æ‰‹çš„ç³»ç»Ÿæç¤ºè¯åé¢ï¼Œå¯ç”¨äºç»Ÿä¸€è§„å®šæ•´ä½“é£æ ¼å’Œå®‰å…¨è¾¹ç•Œã€‚
                            </p>
                        </div>
                    </div>

                    <div class="aa-agents-header">
                        <h3>å·²é…ç½®çš„ Agent åŠ©æ‰‹</h3>
                        <div class="aa-agents-actions">
                            <div class="aa-existing-helper">
                                <label for="aa-existing-agent-select">ä»å·²æ³¨å†Œ Agent åˆ›å»ºï¼š</label>
                                <select id="aa-existing-agent-select">
                                    <option value="">é€‰æ‹©ä¸€ä¸ªå·²æ³¨å†Œ Agent...</option>
                                </select>
                                <button id="aa-add-from-existing-button" type="button">æ·»åŠ </button>
                            </div>
                            <button id="aa-add-custom-agent-button" type="button">æ·»åŠ è‡ªå®šä¹‰ Agent</button>
                        </div>
                    </div>

                    <div id="aa-agent-cards-container" class="aa-agent-cards-container">
                        <!-- Agent cards will be rendered here -->
                    </div>

                    <div class="aa-footer-actions">
                        <button id="aa-save-config-button" type="button">ä¿å­˜ AgentAssistant é…ç½®</button>
                        <span id="aa-status" class="status-message"></span>
                    </div>
                </div>
            </section>

            <section id="tvs-files-editor-section" class="config-section">
                <h2>é«˜çº§å˜é‡ç¼–è¾‘å™¨ (.txt)</h2>
                <div class="tvs-editor-controls">
                    <label for="tvs-file-select">é€‰æ‹©å˜é‡æ–‡ä»¶:</label>
                    <select id="tvs-file-select">
                        <option value="">è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶...</option>
                    </select>
                    <button id="save-tvs-file-button" disabled>ä¿å­˜å˜é‡æ–‡ä»¶</button>
                    <span id="tvs-file-status" class="status-message"></span>
                </div>
                <textarea id="tvs-file-content-editor" spellcheck="false" placeholder="é€‰æ‹©ä¸€ä¸ªå˜é‡æ–‡ä»¶ä»¥ç¼–è¾‘å…¶å†…å®¹..."></textarea>
            </section>

            <!-- Section: Tool List Editor -->
            <section id="tool-list-editor-section" class="config-section">
                <iframe data-src="tool_list_editor.html" style="width: 100%; height: 100vh; border: none;"></iframe>
            </section>

            <section id="server-log-viewer-section" class="config-section">
                <h2>æœåŠ¡å™¨å®æ—¶æ—¥å¿—</h2>
                <div class="log-viewer-container">
                    <div class="log-header">
                        <span id="server-log-path-display">å½“å‰æ—¥å¿—æ–‡ä»¶: åŠ è½½ä¸­...</span>
                        <input type="text" id="server-log-filter" placeholder="ğŸ” è¿‡æ»¤æ—¥å¿—å†…å®¹...">
                        <span id="server-log-line-count">0 è¡Œ</span>
                        <span id="server-log-status" class="status-message info">å°±ç»ª</span>
                        <button id="reverse-server-log-button" class="btn-secondary">ğŸ”ƒ å€’åºæ˜¾ç¤º</button>
                        <button id="copy-server-log-button" class="btn-secondary">ğŸ“‹ å¤åˆ¶</button>
                        <button id="clear-server-log-button" class="btn-secondary">ğŸ—‘ï¸ æ¸…ç©º</button>
                    </div>
                    <pre id="server-log-content" class="log-content-area"></pre>
                </div>
            </section>

           <!-- Section: Preprocessor Order Manager -->
           <section id="preprocessor-order-manager-section" class="config-section">
               <h2>é¢„å¤„ç†å™¨é¡ºåºç®¡ç†</h2>
               <p class="description">åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‹–åŠ¨æ¶ˆæ¯é¢„å¤„ç†å™¨æ’ä»¶æ¥è°ƒæ•´å®ƒä»¬çš„æ‰§è¡Œé¡ºåºã€‚é¡ºåºè¶Šé ä¸Šï¼Œæ‰§è¡Œè¶Šä¼˜å…ˆã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ–°æ’ä»¶çš„æ·»åŠ å’Œæ—§æ’ä»¶çš„ç§»é™¤ã€‚</p>
               <div class="preprocessor-order-controls">
                   <button id="save-preprocessor-order-button">ä¿å­˜é¡ºåºå¹¶çƒ­é‡è½½</button>
                   <span id="preprocessor-order-status" class="status-message"></span>
               </div>
               <ul id="preprocessor-list" class="draggable-list">
                   <!-- æ’ä»¶å°†åŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
               </ul>
           </section>

           <!-- Section: Thinking Chains Editor -->
           <section id="thinking-chains-editor-section" class="config-section">
               <h2>æ€ç»´é“¾ç¼–è¾‘å™¨</h2>
               <p class="description">ç®¡ç† RAGDiaryPlugin ä½¿ç”¨çš„å…ƒæ€è€ƒé“¾ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸åŒçš„æ€è€ƒä¸»é¢˜ï¼Œå¹¶æ‹–æ‹½æ’åºå…¶ä¸­çš„æ€ç»´ç°‡æ¨¡å—ã€‚</p>
               <div id="thinking-chains-editor-controls" class="form-actions" style="margin-bottom: 1rem;">
                   <button id="save-thinking-chains-button">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
                   <button id="add-thinking-chain-theme-button">æ·»åŠ æ–°ä¸»é¢˜</button>
                   <span id="thinking-chains-status" class="status-message"></span>
               </div>
               <div id="thinking-chains-container">
                   <!-- Editor will be dynamically loaded here -->
               </div>
           </section>

           <!-- Section: VCP Forum -->
           <section id="vcp-forum-section" class="config-section">
               <h2>VCP è®ºå›</h2>
               <div class="forum-controls">
                   <label for="forum-board-filter">ç­›é€‰æ¿å—:</label>
                   <select id="forum-board-filter">
                       <option value="all">å…¨éƒ¨æ¿å—</option>
                   </select>
                   <input type="search" id="forum-search-input" placeholder="æœç´¢å¸–å­æ ‡é¢˜æˆ–ä½œè€…...">
               </div>
               <div id="forum-posts-container" class="forum-posts-container">
                   <!-- Forum posts will be loaded here -->
               </div>
           </section>

           <!-- Section: Schedule Manager -->
           <section id="schedule-manager-section" class="config-section">
               <h2>æ—¥ç¨‹ç®¡ç†</h2>
               <div class="schedule-manager-container">
                   <div class="schedule-left-panel">
                       <div class="calendar-container card">
                           <div class="calendar-header">
                               <button id="prev-month" class="icon-btn"><span class="material-symbols-outlined">chevron_left</span></button>
                               <h3 id="current-month-year">2023å¹´ 10æœˆ</h3>
                               <button id="next-month" class="icon-btn"><span class="material-symbols-outlined">chevron_right</span></button>
                           </div>
                           <div id="calendar-grid" class="calendar-grid">
                               <!-- æ—¥å†æ ¼å­ -->
                           </div>
                       </div>
                       <div class="add-schedule-form card">
                           <h3>æ·»åŠ æ–°æ—¥ç¨‹</h3>
                           <div class="form-group">
                               <label for="new-schedule-time">æ—¶é—´</label>
                               <input type="datetime-local" id="new-schedule-time">
                           </div>
                           <div class="form-group">
                               <label for="new-schedule-content">å†…å®¹</label>
                               <textarea id="new-schedule-content" rows="3" placeholder="è¾“å…¥æ—¥ç¨‹å†…å®¹..."></textarea>
                           </div>
                           <button id="add-schedule-btn" class="primary-btn">æ·»åŠ æ—¥ç¨‹</button>
                       </div>
                   </div>
                   <div class="schedule-right-panel">
                       <div class="schedule-list-container card">
                           <div class="list-header">
                               <h3>æ—¥ç¨‹åˆ—è¡¨</h3>
                               <div class="list-filters">
                                   <button id="filter-all" class="filter-btn active">å…¨éƒ¨</button>
                                   <button id="filter-upcoming" class="filter-btn">å³å°†åˆ°æ¥</button>
                               </div>
                           </div>
                           <div id="schedule-list" class="schedule-list">
                               <!-- æ—¥ç¨‹æ¡ç›® -->
                               <p class="empty-msg">åŠ è½½ä¸­...</p>
                           </div>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Section: RAG Tuning -->
           <section id="rag-tuning-section" class="config-section">
               <h2>RAG ç®—æ³•è°ƒå‚ (rag_params.json)</h2>
               <p class="description">åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥å®æ—¶è°ƒæ•´ TagMemo ç®—æ³•çš„å„é¡¹æ ¸å¿ƒå‚æ•°ã€‚æ‰€æœ‰æ›´æ”¹å°†ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡å™¨ã€‚</p>
               
               <div class="rag-tuning-container">
                   <div class="rag-tuning-main">
                       <form id="rag-params-form">
                           <div id="rag-params-content">
                               <!-- å‚æ•°å°†åŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                               <p class="loading-msg">æ­£åœ¨åŠ è½½å‚æ•°...</p>
                           </div>
                           <div class="form-actions">
                               <button type="submit" class="primary-btn">ä¿å­˜å‚æ•°é…ç½®</button>
                               <button type="button" id="reset-rag-params" class="btn-secondary">é‡ç½®æ›´æ”¹</button>
                               <span id="rag-params-status" class="status-message"></span>
                           </div>
                       </form>
                   </div>
               </div>
           </section>
        </main>
    </div>

    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>æ­£åœ¨åŠ è½½...</p>
    </div>
    <div id="message-popup" class="message-popup"></div>

    <script type="module" src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('vcp-animation-canvas');
            if(canvas) {
                const ctx = canvas.getContext('2d');
                let width = canvas.offsetWidth;
                let height = canvas.offsetHeight;
                canvas.width = width;
                canvas.height = height;

                class Particle {
                    constructor() {
                        this.x = Math.random() * width;
                        this.y = Math.random() * height;
                        this.vx = Math.random() * 1 - 0.5;
                        this.vy = Math.random() * 1 - 0.5;
                        this.radius = Math.random() * 1.5 + 1;
                        this.opacity = Math.random() * 0.5 + 0.2;
                    }

                    draw() {
                        const theme = document.documentElement.getAttribute('data-theme') || 'dark';
                        const particleColor = theme === 'dark' ? '#8ab4f8' : '#1a73e8';
                        
                        // Helper to convert hex to rgba for opacity
                        const hexToRgb = (hex) => {
                            let r = 0, g = 0, b = 0;
                            if (hex.length == 4) {
                                r = "0x" + hex[1] + hex[1];
                                g = "0x" + hex[2] + hex[2];
                                b = "0x" + hex[3] + hex[3];
                            } else if (hex.length == 7) {
                                r = "0x" + hex[1] + hex[2];
                                g = "0x" + hex[3] + hex[4];
                                b = "0x" + hex[5] + hex[6];
                            }
                            return `rgba(${+r},${+g},${+b},${this.opacity})`;
                        }

                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.fillStyle = hexToRgb(particleColor);
                        ctx.fill();
                    }

                    update() {
                        this.x += this.vx;
                        this.y += this.vy;

                        if (this.x < 0 || this.x > width) this.vx *= -1;
                        if (this.y < 0 || this.y > height) this.vy *= -1;
                    }
                }
                
                let particles = [];
                function init() {
                    width = canvas.offsetWidth;
                    height = canvas.offsetHeight;
                    canvas.width = width;
                    canvas.height = height;
                    particles = [];
                    for (let i = 0; i < 100; i++) {
                        particles.push(new Particle());
                    }
                }

                function animate() {
                    ctx.clearRect(0, 0, width, height);
                    particles.forEach(p => {
                        p.update();
                        p.draw();
                    });

                    for (let i = 0; i < particles.length; i++) {
                        for (let j = i + 1; j < particles.length; j++) {
                            const dx = particles[i].x - particles[j].x;
                            const dy = particles[i].y - particles[j].y;
                            const distance = Math.sqrt(dx * dx + dy * dy);

                            if (distance < 100) {
                                const theme = document.documentElement.getAttribute('data-theme') || 'dark';
                                const lineColor = theme === 'dark' ? '#8ab4f8' : '#1a73e8';
                                const hexToRgbA = (hex, alpha) => {
                                    let r = 0, g = 0, b = 0;
                                    if (hex.length == 4) {
                                        r = "0x" + hex[1] + hex[1];
                                        g = "0x" + hex[2] + hex[2];
                                        b = "0x" + hex[3] + hex[3];
                                    } else if (hex.length == 7) {
                                        r = "0x" + hex[1] + hex[2];
                                        g = "0x" + hex[3] + hex[4];
                                        b = "0x" + hex[5] + hex[6];
                                    }
                                    return `rgba(${+r},${+g},${+b},${alpha})`;
                                }

                                ctx.beginPath();
                                ctx.moveTo(particles[i].x, particles[i].y);
                                ctx.lineTo(particles[j].x, particles[j].y);
                                ctx.strokeStyle = hexToRgbA(lineColor, (100 - distance) / 100 * 0.5);
                                ctx.lineWidth = 0.5;
                                ctx.stroke();
                            }
                        }
                    }

                    requestAnimationFrame(animate);
                }
                
                // Debounce resize
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(init, 250);
                });
                
                // Re-init on theme change
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === "data-theme") {
                           init();
                        }
                    });
                });

                observer.observe(document.documentElement, { attributes: true });

                init();
                animate();
            }
        });

        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢é€»è¾‘
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        const contentOverlay = document.createElement('div');
        contentOverlay.className = 'sidebar-overlay';
        document.body.appendChild(contentOverlay);

        if (mobileMenuToggle && sidebar) {
            mobileMenuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-active');
                contentOverlay.classList.toggle('active');
            });

            contentOverlay.addEventListener('click', () => {
                sidebar.classList.remove('mobile-active');
                contentOverlay.classList.remove('active');
            });

            // ç‚¹å‡»å¯¼èˆªé“¾æ¥åè‡ªåŠ¨å…³é—­ä¾§è¾¹æ 
            const navLinks = sidebar.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('mobile-active');
                        contentOverlay.classList.remove('active');
                    }
                });
            });
        }

        // ä¸»é¢˜åˆ‡æ¢é€»è¾‘ä¿æŒä¸å˜
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
        const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                if(themeToggleButton) themeToggleButton.textContent = 'åˆ‡æ¢äº®è‰²';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                if(themeToggleButton) themeToggleButton.textContent = 'åˆ‡æ¢æš—è‰²';
            }
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(iframe => {
                if (iframe.contentWindow) {
                    iframe.contentWindow.postMessage({ type: 'themeChange', theme: theme }, '*');
                }
            });
        }

        if (currentTheme) {
            applyTheme(currentTheme);
        } else {
            if (prefersDarkScheme.matches) {
                applyTheme('dark');
            } else {
                applyTheme('light');
            }
        }

        if (themeToggleButton) {
            themeToggleButton.addEventListener('click', () => {
                let newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });
        }

        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'requestTheme') {
                const currentAppliedTheme = document.documentElement.getAttribute('data-theme') || (prefersDarkScheme.matches ? 'dark' : 'light');
                const sourceFrame = Array.from(document.querySelectorAll('iframe')).find(
                    iframe => iframe.contentWindow === event.source
                );
                if (sourceFrame && sourceFrame.contentWindow) {
                     sourceFrame.contentWindow.postMessage({ type: 'themeChange', theme: currentAppliedTheme }, '*');
                }
            }
        });
    </script>
</body>
</html>